<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analytics - Smart Study Planner</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <div class="app-container">
      <aside class="sidebar">
        <div class="logo-area">
          <span class="logo-text">StudyPlanner</span>
        </div>

        <nav class="nav-menu">
          <a href="index.html" class="nav-link">Dashboard</a>
          <a href="subjects.html" class="nav-link">Subjects</a>
          <a href="schedule.html" class="nav-link">Schedule</a>
          <a href="tasks.html" class="nav-link">Tasks</a>
          <a href="analytics.html" class="nav-link">Analytics</a>
          <a href="settings.html" class="nav-link">Settings</a>
        </nav>
      </aside>

      <main class="main-content">
        <header class="top-bar">
          <button id="menu-toggle">â˜°</button>
          <h1 id="page-title">Analytics</h1>
          <div class="header-actions">
            <span class="date-display" id="date-display"></span>
            <button id="theme-toggle" class="theme-btn">Toggle Theme</button>
          </div>
        </header>

        <div class="view-container">
          <h2 style="margin-bottom: 20px">Study Analytics</h2>

          <div class="row" style="gap: 20px; margin-bottom: 30px">
            <div class="card stat-card">
              <h3>Total Tasks</h3>
              <div class="stat-number" id="total-tasks">0</div>
            </div>

            <div class="card stat-card">
              <h3>Completed</h3>
              <div class="stat-number" style="color: #2a9d8f" id="completed-tasks">0</div>
            </div>

            <div class="card stat-card">
              <h3>Completion Rate</h3>
              <div class="stat-number" id="completion-rate">0%</div>
            </div>
          </div>

          <div class="card">
            <h3 class="section-title">Tasks by Subject</h3>
            <div id="subject-breakdown"></div>
          </div>
        </div>
      </main>
    </div>

    <script src="js/common.js"></script>
    <script>
      const data = loadData();
      const tasks = data.tasks || [];
      const subjects = data.subjects || [];
      const schedule = data.schedule || [];

      const totalTasks = tasks.length;
      const completedTasks = tasks.filter((t) => t.completed).length;
      const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

      document.getElementById("total-tasks").textContent = totalTasks;
      document.getElementById("completed-tasks").textContent = completedTasks;
      document.getElementById("completion-rate").textContent = completionRate + "%";

      const subjectBreakdown = {};
      subjects.forEach((sub) => {
        const subTasks = tasks.filter((t) => t.subjectId === sub.id);
        const subCompleted = subTasks.filter((t) => t.completed).length;
        subjectBreakdown[sub.name] = {
          total: subTasks.length,
          completed: subCompleted,
          color: sub.color,
        };
      });

      const breakdownEl = document.getElementById("subject-breakdown");
      if (Object.keys(subjectBreakdown).length === 0) {
        breakdownEl.innerHTML = '<p style="color: #666;">No data available.</p>';
      } else {
        breakdownEl.innerHTML = Object.entries(subjectBreakdown)
          .map(
            ([name, data]) => `
                <div class="analytics-stat">
                    <div class="analytics-stat-header">
                        <strong style="color: ${data.color}">${name}</strong>
                        <span>${data.completed} / ${data.total} tasks</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: ${data.total > 0 ? (data.completed / data.total) * 100 : 0}%; background: ${data.color};"></div>
                    </div>
                </div>
            `,
          )
          .join("");
      }

      const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
      const scheduleOverview = days.map((day) => {
        const dayClasses = schedule.filter((s) => s.day === day).length;
        return { day, count: dayClasses };
      });

      const overviewEl = document.getElementById("schedule-overview");
      overviewEl.innerHTML = scheduleOverview
        .map(
          (item) => `
            <div style="display: flex; justify-content: space-between; padding: 10px; background: #f5f5f5; border-radius: 6px; margin-bottom: 8px;">
                <strong>${item.day}</strong>
                <span>${item.count} ${item.count === 1 ? "class" : "classes"}</span>
            </div>
        `,
        )
        .join("");
    </script>
  </body>
</html>
