<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Smart Study Planner</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <div class="app-container">
      <aside class="sidebar">
        <div class="logo-area">
          <span class="logo-text">StudyPlanner</span>
        </div>

        <nav class="nav-menu">
          <a href="index.html" class="nav-link">Dashboard</a>
          <a href="subjects.html" class="nav-link">Subjects</a>
          <a href="schedule.html" class="nav-link">Schedule</a>
          <a href="tasks.html" class="nav-link">Tasks</a>
          <a href="analytics.html" class="nav-link">Analytics</a>
          <a href="settings.html" class="nav-link">Settings</a>
        </nav>
      </aside>

      <main class="main-content">
        <header class="top-bar">
          <h1 id="page-title">Dashboard</h1>
          <div class="header-actions">
            <span class="date-display" id="date-display"></span>
            <button id="theme-toggle" class="theme-btn">Toggle Theme</button>
          </div>
        </header>

        <div class="view-container">
          <div class="row" style="gap: 20px; margin-bottom: 30px">
            <div class="card stat-card">
              <h3>Active Subjects</h3>
              <div class="stat-number" id="subject-count">0</div>
              <p class="stat-label">Currently enrolled</p>
            </div>

            <div class="card stat-card">
              <h3>Pending Tasks</h3>
              <div class="stat-number" id="task-count">0</div>
              <p class="stat-label">To complete</p>
            </div>

            <div class="card stat-card">
              <h3>Today's Classes</h3>
              <div class="stat-number" id="class-count">0</div>
              <p class="stat-label">Scheduled</p>
            </div>
          </div>

          <div class="row" style="gap: 20px">
            <div class="card">
              <h3 class="section-title">Today's Schedule</h3>
              <div id="today-schedule"></div>
            </div>

            <div class="card">
              <h3 class="section-title">Next Tasks</h3>
              <div id="next-tasks"></div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script src="js/common.js"></script>
    <script>
      const data = loadData();
      const subjects = data.subjects || [];
      const tasks = data.tasks || [];
      const schedule = data.schedule || [];

      document.getElementById("subject-count").textContent = subjects.length;
      document.getElementById("task-count").textContent = tasks.filter((t) => !t.completed).length;

      const today = new Date().toLocaleDateString("en-US", { weekday: "long" });
      const todayClasses = schedule.filter((s) => s.day === today);
      document.getElementById("class-count").textContent = todayClasses.length;

      const scheduleEl = document.getElementById("today-schedule");
      if (todayClasses.length === 0) {
        scheduleEl.innerHTML = '<p style="color: #666;">No classes today.</p>';
      } else {
        scheduleEl.innerHTML = todayClasses
          .sort((a, b) => a.startTime.localeCompare(b.startTime))
          .map((item) => {
            const sub = subjects.find((s) => s.id === item.subjectId);
            return `
                        <div class="schedule-item" style="border-left: 4px solid ${sub ? sub.color : "#ccc"}">
                            <strong>${item.startTime} - ${item.endTime}</strong><br>
                            <span>${sub ? sub.name : "Unknown"}</span>
                            <small style="color: #666;"> (${item.room})</small>
                        </div>
                    `;
          })
          .join("");
      }

      const tasksEl = document.getElementById("next-tasks");
      const nextTasks = tasks
        .filter((t) => !t.completed)
        .sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate))
        .slice(0, 5);

      if (nextTasks.length === 0) {
        tasksEl.innerHTML = '<p style="color: #666;">No pending tasks.</p>';
      } else {
        tasksEl.innerHTML = nextTasks
          .map((task) => {
            const sub = subjects.find((s) => s.id === task.subjectId);
            return `
                    <div class="task-preview" style="border-left: 4px solid ${sub ? sub.color : "#ccc"}">
                        <strong>${task.title}</strong><br>
                        <small style="color: #666;">${sub ? sub.name : "General"} - Due: ${task.dueDate}</small>
                    </div>
                `;
          })
          .join("");
      }
    </script>
  </body>
</html>
